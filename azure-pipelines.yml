trigger:
  branches:
    include:
      - master
      - buildonazure
      - refs/tags/*
stages:
- stage: build
  displayName: Build
  jobs:
  - job: linuxBuild
    displayName: Linux Build
    pool:
      vmImage: ubuntu-18.04
    steps:
    - script: |
        mkdir -p build
        cd build
        apt-get -y update
        apt-get -y install python3.7 cython3 g++ cmake libx11-dev mesa-common-dev libgl1-mesa-dev qt56base qt56svg qt56x11extras libxcb-keysyms1-dev gdb clang-format-3.8 g++-6
        cmake -DCMAKE_BUILD_TYPE=Release ..
        make -j2
      displayName: Linux Build
  - job: macOSBuild
    displayName: MacOS Build
    pool:
      vmImage: macOS-10.14
    steps:
    - task: UsePythonVersion@0
      displayName: 'Set Python Version'
      inputs:
        versionSpec: '3.7'
        addToPath: true
        architecture: 'x64'
    - script: |
        python -m pip install --upgrade pip setuptools wheel
        pip install Cython --install-option="--no-cython-compile"
        brew update
        brew install qt5 lftp autotools
        brew link qt5 --force
      displayName: 'Install Cython'
    - script: |
        mkdir -p build
        cd build
        cmake -DCMAKE_BUILD_TYPE=Release ..
        make -j2
      displayName: MacOS Build
  - job: windowsBuild
    displayName: Windows Build
    pool:
      vmImage: vs2017-win2016
    steps:
    - task: UsePythonVersion@0
      displayName: 'Set Python Version'
      inputs:
        versionSpec: '3.7'
        addToPath: true
        architecture: 'x64'
    - script: |
        python -m pip install --upgrade pip setuptools wheel
        pip install Cython --install-option="--no-cython-compile"
      displayName: 'Install Cython'
    - script: |
        call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\VC\Auxiliary\Build\vcvarsall.bat" x64
        msbuild renderdoc.sln /v:m "/p:Configuration=Release" "/p:Platform=x64" "/p:PlatformToolset=v141"
      env:
        DISTUTILS_USE_SDK: 1
        PY_VCRUNTIME_REDIST: No
      displayName: Build Windows